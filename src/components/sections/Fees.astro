---
import { z } from 'astro:content';

import { multiLingualSchema } from '@utils/zod.ts';
import { getLocaleData, getLocaleFromURL } from '@utils/locale.ts';

import data from '@content/fees.json';
import Markdown from '@components/Markdown.astro';

const locale = getLocaleFromURL(Astro.url);

const contentSchema = multiLingualSchema(
  z.object({
    title: z.string(),
    groupCoursesTitle: z.string(),
    groupCoursesDescription: z.string(),
    groupCourses: z.array(
      z.object({
        length: z.number(),
        normalRate: z.number(),
        reducedRate: z.number(),
        description: z.string(),
      }),
    ),
    privateCoursesTitle: z.string(),
    privateCoursesDescription: z.string(),
    privateCourses: z.array(
      z.object({
        length: z.number(),
        onePersonRate: z.number(),
        twoPersonsRate: z.number(),
        threePersonsRate: z.number(),
        description: z.string(),
      }),
    ),
  }),
);

const parsedData = contentSchema.parse(data);

const content = getLocaleData(locale, parsedData);
---

<div id="fees" class="mt-4 flex w-full flex-col justify-center">
  <h1>{content.title}</h1>
  <h2>{content.groupCoursesTitle}</h2>
  <p>{content.groupCoursesDescription}</p>
  {
    content.groupCourses.map((course) => (
      <div class="mb-4">
        <table class="my-2 w-full max-w-3xl divide-y-2 divide-gray-200">
          <thead>
            <tr class="text-left *:text-gray-900 *:first:font-medium">
              <th class="w-1/4 px-3 py-2 whitespace-nowrap">
                Group Course ({course.length} min)
              </th>
              <th class="px-3 py-2 text-left whitespace-nowrap">Normal Rate</th>
              <th class="px-3 py-2 text-left whitespace-nowrap">
                Reduced Rate
              </th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            <tr class="*:font-medium *:text-gray-900">
              <td class="px-3 py-2 whitespace-nowrap">{course.length} min</td>
              <td class="px-3 py-2 whitespace-nowrap">
                {course.normalRate} CHF
              </td>
              <td class="px-3 py-2 whitespace-nowrap">
                {course.reducedRate} CHF
              </td>
            </tr>
          </tbody>
        </table>
        <Markdown markdown={course.description} />
      </div>
    ))
  }
  <h2>{content.privateCoursesTitle}</h2>
  <p>{content.privateCoursesDescription}</p>
  {
    content.privateCourses.map((course) => (
      <div class="mb-4">
        <table class="my-2 w-full max-w-3xl divide-y-2 divide-gray-200">
          <thead>
            <tr class="text-left *:text-gray-900 *:first:font-medium">
              <th class="w-1/4 px-3 py-2 whitespace-nowrap">
                Private Course ({course.length} min)
              </th>
              <th class="px-3 py-2 text-left whitespace-nowrap">1 Person</th>
              <th class="px-3 py-2 text-left whitespace-nowrap">2 Persons</th>
              <th class="px-3 py-2 text-left whitespace-nowrap">3 Persons</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            <tr class="*:font-medium *:text-gray-900">
              <td class="px-3 py-2 whitespace-nowrap">{course.length} min</td>
              <td class="px-3 py-2 whitespace-nowrap">
                {course.onePersonRate} CHF
              </td>
              <td class="px-3 py-2 whitespace-nowrap">
                {course.twoPersonsRate} CHF
              </td>
              <td class="px-3 py-2 whitespace-nowrap">
                {course.threePersonsRate} CHF
              </td>
            </tr>
          </tbody>
        </table>
        <Markdown markdown={course.description} />
      </div>
    ))
  }
</div>
