---
import { z } from 'astro:content';

import Layout from '@layouts/Layout.astro';

import Markdown from '@components/Markdown.astro';
import Banner from '@components/Banner.astro';

import vinyard from 'public/assets/bgVineyard.jpg';

import { multiLingualSchema } from '@utils/zod.ts';
import { getLocaleData, getLocaleFromURL } from '@utils/locale.ts';

import Fees from '@components/sections/Fees.astro';
import Courses from '@components/sections/Courses.astro';
import Contact from '@components/sections/Contact.astro';

import data from '@content/home.json';

const locale = getLocaleFromURL(Astro.url);

const contentSchema = multiLingualSchema(
  z.object({
    title: z.string(),
    intro: z.string(),
    banner: z
      .object({
        message: z.string(),
        linkText: z.string(),
        linkUrl: z.string(),
      })
      .optional(),
  }),
);

const parsedData = contentSchema.parse(data);

const teamLink = `/${locale}/team`;

const content = getLocaleData(locale, parsedData);
---

<Layout locale={locale}>
  <div class="flex w-full justify-center">
    <div class="mx-auto max-h-full">
      {
        content.banner && (
          <Banner
            message={content.banner.message}
            linkText={content.banner.linkText}
            linkUrl={content.banner.linkUrl ?? '#courses'}
          />
        )
      }
      <div class="flex max-h-full flex-col gap-4 md:flex-row">
        <div class="relative max-w-full bg-black">
          <img
            src={vinyard.src}
            alt="Vineyard background"
            class="absolute inset-0 h-full w-full object-cover"
          />
          <div
            class="relative flex h-full max-w-full items-center justify-center bg-black/40 p-4"
          >
            <div class="m-auto bg-black/40 p-3 text-left text-white">
              <h1 class="text-white">{content.title}</h1>

              <p class="sm:mt-4">
                <Markdown markdown={content.intro} />
              </p>

              <a
                href="#courses"
                class="mt-4 inline-block bg-white p-3 text-black"
              >
                Have a look at our courses
              </a>
            </div>
          </div>
        </div>

        <div
          class="flex min-h-40 min-w-1/2 flex-row gap-4 overflow-hidden md:max-h-full"
        >
          <a href={teamLink} class="group relative block flex-1 bg-black">
            <img
              alt="Angela Eibner"
              src="/assets/angela.jpeg"
              class="absolute inset-0 h-full w-full object-cover opacity-75 transition-opacity group-hover:opacity-50"
            />

            <div
              class="translate-y-8 transform p-4 opacity-0 transition-all group-hover:translate-y-0 group-hover:opacity-100"
            >
              <p class="text-xl font-bold text-white sm:text-2xl">
                Angela Eibner
              </p>
              <p class="text-sm text-white">Meet our teacher</p>
            </div>
          </a>

          <a href={teamLink} class="group relative block flex-1 bg-black">
            <img
              alt="Bev Visser"
              src="/assets/bev.jpeg"
              class="absolute inset-0 h-full w-full object-cover opacity-75 transition-opacity group-hover:opacity-50"
            />

            <div
              class="translate-y-8 transform p-4 opacity-0 transition-all group-hover:translate-y-0 group-hover:opacity-100"
            >
              <p class="text-xl font-bold text-white sm:text-2xl">Bev Visser</p>
              <p class="text-sm text-white">Meet our teacher</p>
            </div>
          </a>
        </div>
      </div>
      <Courses />
      <Fees />
      <Contact />
    </div>
  </div>
</Layout>
